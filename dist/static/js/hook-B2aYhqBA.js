import{k as u,l as D,z as O,e as f,n as k,Q as d,aE as p,aw as w,aU as z,m as v,r as b,ah as C,aY as B}from"./index-DLbSnZ-2.js";import{_ as H}from"./description.vue_vue_type_style_index_0_lang-BxX6UK_U.js";import{a as I,b as y,c as Y}from"./log-meop4lWx.js";import{C as n}from"./common-MP0nqKMS.js";import"./index-CqpMF8Ft.js";const h=v().dictionaryMap["sysOperationLog.status"],T=v().dictionaryMap["sysOperationLog.businessType"];function _(){const r={prop:"operationTime",order:"descending"},o={total:0,pageSize:10,currentPage:1,background:!0},l=u([]),t=D({beginTime:void 0,endTime:void 0,businessType:void 0,requestModule:void 0,status:void 0,username:void 0,timeRangeColumn:r.prop}),m=u([]),c=u(!0),i=u([]),L=[{type:"selection",align:"left"},{label:"操作编号",prop:"operationId",minWidth:100},{label:"业务模块",prop:"requestModule",minWidth:120},{label:"操作类型",prop:"businessType",minWidth:120,cellRenderer:({row:e,props:a})=>f(b("el-tag"),{size:a.size,type:T[e.businessType].cssTag,effect:"plain"},{default:()=>[T[e.businessType].label]})},{label:"请求方式",prop:"requestMethod",minWidth:120},{label:"操作人员",prop:"username",minWidth:120},{label:"登录地址",prop:"operatorIp",minWidth:120},{label:"状态",prop:"status",minWidth:120,cellRenderer:({row:e,props:a})=>f(b("el-tag"),{size:a.size,type:h[e.status].cssTag,effect:"plain"},{default:()=>[h[e.status].label]})},{label:"状态名",prop:"statusStr",minWidth:120,hide:!0},{label:"操作时间",minWidth:160,prop:"operationTime",sortable:"custom",formatter:({operationTime:e})=>k(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:140,slot:"operation"}];async function g(){o.currentPage=1,s()}function M(e,a){e&&(e.resetFields(),t.orderColumn=void 0,t.orderDirection=void 0,l.value=[],t.beginTime=void 0,t.endTime=void 0,a.getTableRef().clearSort(),g())}async function s(e=r){c.value=!0,e!=null&&n.fillSortParams(t,e),n.fillPaginationParams(t,o),n.fillTimeRangeParams(t,l.value);const{data:a}=await I(d(t)).finally(()=>{c.value=!1});m.value=a.rows,o.total=a.total}async function S(e=r){e!=null&&n.fillSortParams(t,e),n.fillPaginationParams(t,o),n.fillTimeRangeParams(t,l.value),Y(d(t),"操作日志.xls")}async function x(e){await y([e.operationId]).then(()=>{p(`您删除了操作编号为${e.operationId}的这条数据`,{type:"success"}),s()})}async function P(e){if(i.value.length===0){p("请选择需要删除的数据",{type:"warning"});return}w.confirm(`确认要<strong>删除</strong>编号为<strong style='color:var(--el-color-primary)'>[ ${i.value} ]</strong>的日志吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(async()=>{await y(i.value).then(()=>{p(`您删除了日志编号为[ ${i.value} ]的数据`,{type:"success"}),s()})}).catch(()=>{p("取消删除",{type:"info"}),e.getTableRef().clearSelection()})}function R(e){z({title:"日志详情",width:"60%",draggable:!0,fullscreenIcon:!1,closeOnClickModal:!0,contentRenderer:()=>C(H,d(e)),footerButtons:[{label:"关闭",text:!0,size:"large",bg:!0,btnClick:({dialog:{options:a,index:W}})=>{B(a,W)}}]})}return O(()=>{s()}),{searchFormParams:t,pageLoading:c,columns:L,dataList:m,pagination:o,defaultSort:r,timeRange:l,multipleSelection:i,onSearch:g,exportAllExcel:S,getOperationLogList:s,resetForm:M,openDialog:R,handleDelete:x,handleBulkDelete:P}}export{_ as useOperationLogHook};
