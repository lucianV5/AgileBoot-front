import{aZ as B,a_ as d,l as A,k as r,x as F,M as y,aV as N,z as L,e as p,n as x,aE as c,aW as C,aU as H,a$ as O,r as P,ah as U}from"./index-DLbSnZ-2.js";import{_ as Y}from"./form.vue_vue_type_script_setup_true_lang-D-Bi59IY.js";import{C as _}from"./common-MP0nqKMS.js";import{g,d as j,a as z,b as V,u as q}from"./menu-1b5jiDSW.js";import{u as Z}from"./hooks-_COpLDj5.js";import"./index-M2tAlyFk.js";import"./index-CqpMF8Ft.js";function E(t,s){t.menuName&&t.meta&&(t.meta.title=t.menuName),(t.menuType==1||t.menuType==2)&&t.path&&!t.path.startsWith("/")&&(t.path=`/${t.path}`);const a=B(s,t.parentId);if(a&&!t.isButton&&(!a.children||a.children.length===0)&&(t.meta.showParent=!0),t.menuType==3){t.menuType==3&&t.meta&&t.meta.frameSrc&&(d(t.meta.frameSrc)||(t.meta.frameSrc.startsWith("/")?t.meta.isFrameSrcInternal=!0:t.meta.frameSrc=`http://${t.meta.frameSrc}`));const m=_.toPinyin(t.menuName);t.path=`/${m}IframeLink`,t.routerName=`${m}IframeRouter`}t.meta&&t.menuType==4&&(d(t.routerName)||(t.routerName=`http://${t.routerName}`),t.path="/external")}function te(){const t=A({menuName:"",status:null}),s=r(),a=r([]),m=F(()=>{let n=[...a.value];return y(t.menuName)||(n=n.filter(e=>e.menuName.includes(t.menuName))),y(t.status)||(n=n.filter(e=>e.status===t.status)),[...N(n)]}),u=r(!0),{tagStyle:b}=Z(),I=[{label:"菜单名称",prop:"menuName",width:200,align:"left"},{label:"页面路径",prop:"path",minWidth:170},{label:"路由名称",prop:"routerName",width:160,align:"center"},{label:"图标",prop:"row.icon",minWidth:40,cellRenderer:({row:n})=>p("div",{class:"flex justify-center"},[p(O,{icon:n.icon},null)])},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:n,props:e})=>p(P("el-tag"),{size:e.size,style:b.value(n.status)},{default:()=>[n.status===1?"启用":"停用"]})},{label:"类型",prop:"isButton",minWidth:100,formatter:({isButton:n})=>n?"按钮":"菜单"},{label:"子类型",prop:"menuTypeStr",minWidth:100},{label:"排序",prop:"rank",minWidth:70},{label:"创建时间",minWidth:200,prop:"createTime",formatter:({createTime:n})=>x(n).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:240,slot:"operation"}];function T(n){n&&(n.resetFields(),i())}async function i(){u.value=!0;const{data:n}=await g({isButton:null}).finally(()=>{u.value=!1});a.value=n}async function M(n,e){await V(n).then(()=>{c(`您新增了菜单:${n.menuName}`,{type:"success"}),e(),i()})}async function S(n,e){await q(n.id,n).then(()=>{c(`您更新了菜单:${n.menuName}`,{type:"success"}),e(),i()})}async function v(n="新增",e){const{data:W}=await g({isButton:!1}),f=C(N(W),"status");let o;n==="编辑"&&(e=(await z(e.id+"")).data,o=e.meta),H({title:`${n}菜单`,props:{formInline:{id:(e==null?void 0:e.id)??0,parentId:(e==null?void 0:e.parentId)??0,menuName:(e==null?void 0:e.menuName)??"",routerName:(e==null?void 0:e.routerName)??"",path:(e==null?void 0:e.path)??"",isButton:e==null?void 0:e.isButton,permission:(e==null?void 0:e.permission)??"",menuType:(e==null?void 0:e.menuType)??void 0,status:(e==null?void 0:e.status)??1,meta:o??{rank:0}},higherMenuOptions:[...f]},width:"60%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>U(Y,{ref:s}),beforeSure:(h,{options:$})=>{const R=s.value.getRef(),l=$.props.formInline;E(l,f),R.validate(k=>{k&&(n==="新增"?M(l,h):S(l,h))})}})}async function D(n){await j(n.id).then(()=>{c(`您删除了${n.menuName}`,{type:"success"}),i()})}return L(()=>{i()}),{searchFormParams:t,loading:u,columns:I,dataList:m,onSearch:i,resetForm:T,openDialog:v,handleDelete:D}}export{te as useHook};
