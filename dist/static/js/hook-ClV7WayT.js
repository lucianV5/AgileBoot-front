import{d as Y,l as O,bk as Q,k as a,r as p,h as q,o as G,i as y,e as f,f as b,g as W,aT as J,aE as r,x as K,z as X,aW as Z,aV as w,n as ee,aU as U,Q as M,ah as A,aw as te}from"./index-DLbSnZ-2.js";import{d as ae,g as se,c as ne,e as le,f as ie,h as oe,i as de}from"./user-CNETU6zZ.js";import{_ as re}from"./form.vue_vue_type_script_setup_true_lang-DUu5HB2G.js";import{_ as ue}from"./passwordForm.vue_vue_type_script_setup_true_lang-ucIJtU-i.js";import{C as L}from"./common-MP0nqKMS.js";import{a as pe}from"./dept-CNyEMDwu.js";import{g as ce}from"./post-CAgdbTIk.js";import{a as me}from"./role-Bt7LqOtR.js";const fe={class:"el-upload__tip text-center"},ge=Y({__name:"uploadForm",setup(i,{expose:g}){const{getList:v}=S(),n=O({open:!1,title:"",loading:!1,headers:{Authorization:`Bearer ${Q().token}`},url:"/dev-api/system/users/excel"});function c(){J.download("system/users/excelTemplate",`user_template_${new Date().getTime()}.xls`)}const m=()=>{n.loading=!0},o=()=>{n.open=!1,n.loading=!1,u.value.clearFiles(),r("导入成功",{type:"success"}),v()},u=a();function h(){return u.value}return g({getFormRef:h}),(R,l)=>{const I=p("upload-filled"),k=p("el-icon"),_=p("el-link"),T=p("el-upload");return G(),q(T,{ref_key:"formRef",ref:u,limit:1,accept:".xlsx,.xls",headers:n.headers,action:n.url,disabled:n.loading,"on-progress":m,"on-success":o,"auto-upload":!1,drag:""},{tip:y(()=>[b("div",fe,[l[1]||(l[1]=b("span",null,"仅允许导入xls、xlsx格式文件。",-1)),f(_,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:c},{default:y(()=>l[0]||(l[0]=[W("下载模板")])),_:1,__:[0]})])]),default:y(()=>[f(k,{class:"el-icon--upload"},{default:y(()=>[f(I)]),_:1}),l[2]||(l[2]=b("div",{class:"el-upload__text"},[W("将文件拖到此处，或"),b("em",null,"点击上传")],-1))]),_:1,__:[2]},8,["headers","action","disabled"])}}});function S(){const i=O({deptId:void 0,phoneNumber:void 0,status:void 0,username:void 0,timeRangeColumn:"createTime"}),g=a(),v=a(),n=a([]),c=a(!0),m=a({}),o=O({total:0,pageSize:10,currentPage:1,background:!0}),u=a([]),h=a([]),R=a([]),l=[{label:"用户编号",prop:"userId",width:90,fixed:"left"},{label:"用户名",prop:"username",minWidth:130},{label:"昵称",prop:"nickname",minWidth:130},{label:"性别",prop:"sex",minWidth:90,cellRenderer:({row:t,props:e})=>f(p("el-tag"),{size:e.size,type:t.sex===1?"":"danger",effect:"plain"},{default:()=>[t.sex===1?"男":"女"]})},{label:"部门ID",prop:"deptId",minWidth:130,hide:!0},{label:"部门",prop:"deptName",minWidth:130},{label:"手机号码",prop:"phoneNumber",minWidth:90},{label:"角色ID",prop:"roleId",minWidth:90,hide:!0},{label:"角色",prop:"roleName",minWidth:90},{label:"状态",prop:"status",minWidth:90,cellRenderer:t=>{var e;return f(p("el-switch"),{size:t.props.size==="small"?"small":"default",loading:(e=m.value[t.index])==null?void 0:e.loading,modelValue:t.row.status,"onUpdate:modelValue":s=>t.row.status=s,"active-value":1,"inactive-value":0,"active-text":"正常","inactive-text":"停用","inline-prompt":!0,onChange:()=>k(t)},null)}},{label:"创建时间",minWidth:70,prop:"createTime",formatter:({createTime:t})=>ee(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:180,slot:"operation"}],I=K(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function k({row:t,index:e}){te.confirm(`确认要<strong>${t.status===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${t.username}</strong>用户吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(async()=>{_(e,!0),await de(t.userId,t.status).finally(()=>{_(e,!1)}),r("已成功修改用户状态",{type:"success"})}).catch(()=>{r("取消操作",{type:"info"}),t.status===0?t.status=1:t.status=0})}function _(t,e){m.value[t]=Object.assign({},m.value[t],{loading:e})}async function T(){L.fillPaginationParams(i,o),le(M(i),"用户列表.xls")}async function z(t,e){await ie(t).then(()=>{r(`您新增了用户${t.username}的这条数据`,{type:"success"}),e(),d()})}async function $(t,e){await ne(t.userId,t).then(()=>{r(`您修改了用户${t.username}的这条数据`,{type:"success"}),e(),d()})}async function N(t){await ae(t.userId).then(()=>{r(`您删除了用户${t.username}的这条数据`,{type:"success"}),d()})}async function B(t,e,s){await oe(e).then(()=>{r(`您修改了用户${t.username}的密码`,{type:"success"}),s(),d()})}async function C(){o.currentPage=1,d()}async function V(t="新增",e){U({title:`${t}用户`,props:{formInline:{userId:(e==null?void 0:e.userId)??0,username:(e==null?void 0:e.username)??"",nickname:(e==null?void 0:e.nickname)??"",deptId:(e==null?void 0:e.deptId)??void 0,phoneNumber:(e==null?void 0:e.phoneNumber)??"",email:(e==null?void 0:e.email)??"",password:t=="新增"?"":void 0,sex:(e==null?void 0:e.sex)??void 0,status:(e==null?void 0:e.status)??void 0,postId:(e==null?void 0:e.postId)??void 0,roleId:(e==null?void 0:e.roleId)??void 0,remark:(e==null?void 0:e.remark)??""},deptOptions:u,postOptions:h,roleOptions:R},width:"40%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>A(re,{ref:g}),beforeSure:(s,{options:D})=>{const F=g.value.getFormRuleRef(),x=D.props.formInline;F.validate(P=>{P&&(t==="新增"?z(x,s):$(x,s))})}})}async function j(t){const e=a();U({title:"重置密码",props:{formInline:{userId:t.userId??0,password:""}},width:"30%",closeOnClickModal:!1,contentRenderer:()=>A(ue,{ref:e}),beforeSure:(s,{options:D})=>{const F=e.value.getFormRuleRef(),x=D.props.formInline;F.validate(P=>{P&&B(t,x,s)})}})}async function E(){const t=a();U({title:"导入用户",props:{},width:"30%",closeOnClickModal:!1,contentRenderer:()=>A(ge,{ref:t}),beforeSure:e=>{t.value.getFormRef().submit(),e(),d()}})}async function d(){L.fillPaginationParams(i,o),L.fillTimeRangeParams(i,v.value),c.value=!0;const{data:t}=await se(M(i)).finally(()=>{c.value=!1});n.value=t.rows,o.total=t.total}const H=t=>{t&&(t.resetFields(),C())};return X(async()=>{C();const t=await pe();u.value=await Z(w(t.data),"status");const e=await ce({});h.value=e.data.rows;const s=await me({});R.value=s.data.rows}),{searchFormParams:i,pageLoading:c,columns:l,dataList:n,pagination:o,buttonClass:I,onSearch:C,openDialog:V,exportAllExcel:T,resetForm:H,handleUpdate:$,getList:d,handleDelete:N,openResetPasswordDialog:j,openUploadDialog:E}}const ke=Object.freeze(Object.defineProperty({__proto__:null,useHook:S},Symbol.toStringTag,{value:"Module"}));export{ge as _,ke as h,S as u};
