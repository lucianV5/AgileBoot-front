import{aT as m,d as $,as as x,k as v,R as z,z as N,b1 as k,_ as E,r as L,c as P,o as h,e as w,i as S,f as y,t as T,F,A as I,h as O}from"./index-DLbSnZ-2.js";import{i as Y}from"./index-Bb6yjXMn.js";import{g as B}from"./dept-CNyEMDwu.js";const R=e=>m.request("get","/system/performance/list",{params:e}),ee=e=>m.request("get",`/system/performance/${e}`),ae=e=>m.request("post","/system/performance",{data:e}),re=e=>m.request("put","/system/performance",{data:e}),te=e=>m.request("delete",`/system/performance/${e}`),oe=e=>m.request("get","/system/performance/export",{params:e,responseType:"blob"}),U=$({name:"PerformanceChart",setup(){const{t:e}=x.global,l=v();let t=null;const g=new Date().getFullYear(),_=[];for(let a=g-5;a<=g+2;a++)_.push(a);const q=v(g),f=v(null),d=v([]),b=[e("performance.quarterLabel1"),e("performance.quarterLabel2"),e("performance.quarterLabel3"),e("performance.quarterLabel4")],o=()=>{if(!l.value)return;t=Y(l.value);const a={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[e("performance.deptScore"),e("performance.personalScore"),e("performance.totalScore")]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:b},yAxis:{type:"value",min:0,max:100,interval:20},series:[{name:e("performance.deptScore"),type:"bar",data:[0,0,0,0]},{name:e("performance.personalScore"),type:"bar",data:[0,0,0,0]},{name:e("performance.totalScore"),type:"line",data:[0,0,0,0]}]};t.setOption(a),window.addEventListener("resize",A)},A=()=>{t==null||t.resize()},D=async()=>{if(t)try{const a={pageNum:1,pageSize:100,year:q.value,deptId:f.value||void 0},p=(await R(a)).data.rows,c=[0,0,0,0],s=[0,0,0,0],n=[0,0,0,0],u=[0,0,0,0];p.forEach(r=>{const i=r.quarter-1;i>=0&&i<4&&(c[i]+=r.deptScore,s[i]+=r.personalScore,n[i]+=r.totalScore,u[i]++)});for(let r=0;r<4;r++)u[r]>0&&(c[r]=parseFloat((c[r]/u[r]).toFixed(2)),s[r]=parseFloat((s[r]/u[r]).toFixed(2)),n[r]=parseFloat((n[r]/u[r]).toFixed(2)));t.setOption({series:[{name:e("performance.deptScore"),data:c},{name:e("performance.personalScore"),data:s},{name:e("performance.totalScore"),data:n}]})}catch(a){console.error("Failed to load performance data:",a)}},V=async()=>{try{const a=await B(),C=(c,s=[])=>(!c||!Array.isArray(c)||c.forEach(n=>{n&&(s.push({deptId:n.id||n.deptId,deptName:n.label||n.deptName}),n.children&&n.children.length>0&&C(n.children,s))}),s);let p=[];a.data&&(Array.isArray(a.data)?p=a.data:a.data.children&&Array.isArray(a.data.children)?p=[a.data]:p=[a.data]),d.value=C(p)}catch(a){console.error("Failed to load department data:",a),d.value=[]}};return z(()=>e("performance.performanceAnalysis"),()=>{t&&t.setOption({legend:{data:[e("performance.deptScore"),e("performance.personalScore"),e("performance.totalScore")]},xAxis:{data:[e("performance.quarterLabel1"),e("performance.quarterLabel2"),e("performance.quarterLabel3"),e("performance.quarterLabel4")]}})}),N(()=>{V(),o(),D()}),k(()=>{t&&(t.dispose(),t=null),window.removeEventListener("resize",A)}),{t:e,chartRef:l,selectedYear:q,selectedDeptId:f,deptOptions:d,yearOptions:_,quarterLabels:b,loadChartData:D}}}),j={class:"chart-container"},M={class:"card-header"},G={class:"filter-container"},H={class:"chart-wrapper"},J={ref:"chartRef",class:"chart"};function K(e,l,t,g,_,q){const f=L("el-option"),d=L("el-select"),b=L("el-card");return h(),P("div",j,[w(b,{shadow:"never"},{header:S(()=>[y("div",M,[y("span",null,T(e.t("performance.performanceAnalysis")),1),y("div",G,[w(d,{modelValue:e.selectedYear,"onUpdate:modelValue":l[0]||(l[0]=o=>e.selectedYear=o),placeholder:e.t("performance.yearPlaceholder"),onChange:e.loadChartData},{default:S(()=>[(h(!0),P(F,null,I(e.yearOptions,o=>(h(),O(f,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"]),w(d,{modelValue:e.selectedDeptId,"onUpdate:modelValue":l[1]||(l[1]=o=>e.selectedDeptId=o),placeholder:e.t("performance.deptNamePlaceholder"),onChange:e.loadChartData,clearable:""},{default:S(()=>[(h(!0),P(F,null,I(e.deptOptions,o=>(h(),O(f,{key:o.deptId,label:o.deptName,value:o.deptId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"])])])]),default:S(()=>[y("div",H,[y("div",J,null,512)])]),_:1})])}const Q=E(U,[["render",K],["__scopeId","data-v-36a9daf2"]]),ne=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));export{Q as P,ee as a,ae as b,ne as c,te as d,oe as e,R as g,re as u};
