import{aT as r,l as x,k as l,z as A,e as g,n as H,Q as L,aE as s,aw as U,aU as q,m as N,r as h,ah as B}from"./index-DLbSnZ-2.js";import{_ as F}from"./form.vue_vue_type_script_setup_true_lang-TxEhFG3h.js";import{C as T}from"./common-MP0nqKMS.js";import"./index-CqpMF8Ft.js";const Y=n=>r.request("get","/system/notices",{params:n}),_=n=>r.request("post","/system/notices",{data:n}),j=n=>r.request("put",`/system/notices/${n.noticeId}`,{data:n}),b=n=>r.request("delete","/system/notices",{params:{noticeIds:n.toString()}}),S=N().dictionaryMap["sysNotice.noticeType"],v=N().dictionaryMap["sysNotice.status"];function G(){const n={prop:"createTime",order:"descending"},c={total:0,pageSize:10,currentPage:1,background:!0},i=x({noticeTitle:void 0,noticeType:void 0,creatorName:void 0,orderColumn:n.prop,orderDirection:n.order}),d=l(),m=l([]),u=l(!0),o=l([]),R=[{type:"selection",align:"left"},{label:"通知编号",prop:"noticeId",minWidth:100},{label:"通知标题",prop:"noticeTitle",minWidth:120},{label:"通知类型",prop:"noticeType",minWidth:120,cellRenderer:({row:e,props:t})=>g(h("el-tag"),{size:t.size,type:S[e.noticeType].cssTag,effect:"plain"},{default:()=>[S[e.noticeType].label]})},{label:"状态",prop:"status",minWidth:120,cellRenderer:({row:e,props:t})=>g(h("el-tag"),{size:t.size,type:v[e.status].cssTag,effect:"plain"},{default:()=>[v[e.status].label]})},{label:"通知详情",prop:"noticeContent",minWidth:150},{label:"创建者",prop:"creatorName",minWidth:120},{label:"创建时间",minWidth:180,prop:"createTime",sortable:"custom",formatter:({createTime:e})=>H(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:240,slot:"operation"}];function f(){c.currentPage=1,a()}function M(e,t){e&&(e.resetFields(),i.orderColumn=void 0,i.orderDirection=void 0,t.getTableRef().clearSort(),f())}async function a(e=n){e!=null&&T.fillSortParams(i,e),T.fillPaginationParams(i,c),u.value=!0;const{data:t}=await Y(L(i)).finally(()=>{u.value=!1});m.value=t.rows,c.total=t.total}async function C(e){await b([e.noticeId]).then(()=>{s(`您删除了通知标题为${e.name}的这条数据`,{type:"success"}),a()})}async function D(e){if(o.value.length===0){s("请选择需要删除的数据",{type:"warning"});return}U.confirm(`确认要<strong>删除</strong>编号为<strong style='color:var(--el-color-primary)'>[ ${o.value} ]</strong>的通知吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(async()=>{await b(o.value).then(()=>{s(`您删除了通知编号为[ ${o.value} ]的数据`,{type:"success"}),a()})}).catch(()=>{s("取消删除",{type:"info"}),e.getTableRef().clearSelection()})}async function I(e,t){await _(e).then(()=>{s(`您新增了通知标题为${e.noticeTitle}的这条数据`,{type:"success"}),t(),a()})}async function W(e,t){await j(e).then(()=>{s(`您新增了通知标题为${e.noticeTitle}的这条数据`,{type:"success"}),t(),a()})}function $(e="新增",t){q({title:`${e}公告`,props:{formInline:{noticeTitle:(t==null?void 0:t.noticeTitle)??"",noticeType:(t==null?void 0:t.noticeType)??"",status:(t==null?void 0:t.status)??"",noticeContent:(t==null?void 0:t.noticeContent)??""}},width:"40%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>B(F,{ref:d}),beforeSure:(y,{options:k})=>{const z=d.value.getFormRuleRef(),p=k.props.formInline;z.validate(P=>{P&&(e==="新增"?I(p,y):(p.noticeId=t.noticeId,W(p,y)))})}})}return A(()=>{a()}),{searchFormParams:i,pageLoading:u,columns:R,dataList:m,pagination:c,defaultSort:n,multipleSelection:o,getNoticeList:a,onSearch:f,resetForm:M,openDialog:$,handleDelete:C,handleBulkDelete:D}}export{G as useNoticeHook};
