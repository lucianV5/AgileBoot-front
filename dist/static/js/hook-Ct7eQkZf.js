import{k as u,l as S,z as P,e as x,n as W,Q as p,aE as d,aw as w,m as R,r as M}from"./index-DLbSnZ-2.js";import{g as A,d as f,e as k}from"./log-meop4lWx.js";import{C as a}from"./common-MP0nqKMS.js";import"./index-CqpMF8Ft.js";const h=R().dictionaryMap["sysLoginLog.status"];function B(){const s={prop:"loginTime",order:"descending"},o={total:0,pageSize:10,currentPage:1,background:!0},r=u([]),t=S({ipAddress:void 0,username:void 0,status:void 0,beginTime:void 0,endTime:void 0,timeRangeColumn:s.prop}),g=u([]),c=u(!0),i=u([]),y=[{type:"selection",align:"left"},{label:"日志编号",prop:"logId",minWidth:100},{label:"用户名",prop:"username",minWidth:120,sortable:"custom"},{label:"IP地址",prop:"ipAddress",minWidth:120},{label:"登录地点",prop:"loginLocation",minWidth:120},{label:"操作系统",prop:"operationSystem",minWidth:120},{label:"浏览器",prop:"browser",minWidth:120},{label:"状态",prop:"status",minWidth:120,cellRenderer:({row:e,props:n})=>x(M("el-tag"),{size:n.size,type:h[e.status].cssTag,effect:"plain"},{default:()=>[h[e.status].label]})},{label:"状态名",prop:"statusStr",minWidth:120,hide:!0},{label:"登录时间",minWidth:160,prop:"loginTime",sortable:"custom",formatter:({loginTime:e})=>W(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:140,slot:"operation"}];async function m(){o.currentPage=1,l()}function b(e,n){e&&(e.resetFields(),t.orderColumn=void 0,t.orderDirection=void 0,r.value=[],t.beginTime=void 0,t.endTime=void 0,n.getTableRef().clearSort(),m())}async function l(e=s){c.value=!0,e!=null&&a.fillSortParams(t,e),a.fillPaginationParams(t,o),a.fillTimeRangeParams(t,r.value);const{data:n}=await A(p(t)).finally(()=>{c.value=!1});g.value=n.rows,o.total=n.total}async function L(e=s){e!=null&&a.fillSortParams(t,e),a.fillPaginationParams(t,o),a.fillTimeRangeParams(t,r.value),k(p(t),"登录日志.xls")}async function T(e){await f([e.logId]).then(()=>{d(`您删除了操作编号为${e.logId}的这条数据`,{type:"success"}),l()})}async function v(e){if(i.value.length===0){d("请选择需要删除的数据",{type:"warning"});return}w.confirm(`确认要<strong>删除</strong>编号为<strong style='color:var(--el-color-primary)'>[ ${i.value} ]</strong>的日志吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(async()=>{await f(i.value).then(()=>{d(`您删除了日志编号为[ ${i.value} ]的数据`,{type:"success"}),l()})}).catch(()=>{d("取消删除",{type:"info"}),e.getTableRef().clearSelection()})}return P(()=>{l()}),{searchFormParams:t,pageLoading:c,columns:y,dataList:g,pagination:o,defaultSort:s,timeRange:r,multipleSelection:i,onSearch:m,exportAllExcel:L,getLoginLogList:l,resetForm:b,handleDelete:T,handleBulkDelete:v}}export{B as useLoginLogHook};
